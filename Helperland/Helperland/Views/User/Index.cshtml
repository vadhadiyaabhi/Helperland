@model IEnumerable<ServiceRequest>
@{
    ViewBag.Title = "Helperland - Dashboard";
    ViewBag.Header = "";
}

@*<link href="//cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />*@
<script src="~/lib/jquery/jquery.min.js"></script>
<script src="//cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<script type="text/javascript">
    //window.onload = dataTable;
    //function dataTable() {
    //    console.log("sorting and paging");
    //    $("#myTable").DataTable();
    //}
    $(document).ready(function () {
        $.noConflict();
        $('#myTable').dataTable();
    });
</script>
<div class="service-history-table dashboard-table service-history">
    <div class="d-flex justify-content-between align-item-center py-2">
        <span class="table-heading">Service History</span>
        <a href="" class="export-button">Export</a>
    </div>
    <table class="" style="width: 100%;" id="myTable">
        <thead class="">
        <th width="16%"><a href="#">Service ID <img src="~/images/sort.png" alt=""></a></th>
        <th width="19%"><a href="#">Service Details <img src="~/images/sort.png" alt=""></a></th>
        <th width="25%" style="width:25%;"><a href="#">Service Provider <img src="~/images/sort.png" alt=""></a></th>
        <th width="15%" class="text-center">
            <a href="#">Payment <img src="~/images/sort.png" alt=""></a>
        </th>
        <th width="25%" class="text-center">
            <a>Actions</a>
        </th>
        </thead>
        <tbody>
            @foreach (ServiceRequest service in Model)
            {
                <tr>
                    <td>@service.ServiceRequestId</td>
                    <td>
                        <div class="d-none">@String.Format("{0:yyyy/MM/dd}", service.ServiceStartDate) @Convert.ToDateTime(service.ServiceStartDate).TimeOfDay</div>
                        <div class="line-break">
                            <a href="" class="fw-bold"><img src="~/images/calendar2.png" alt="">@String.Format("{0:dd/MM/yyyy}", service.ServiceStartDate)</a>
                            @*<a href="" class="fw-bold"><img src="~/images/calendar2.png" alt="">@Convert.ToDateTime(service.ServiceStartDate).Date</a>*@
                            <a href=""><img src="~/images/layer-712.png" alt="">@(Convert.ToString(Convert.ToDateTime(service.ServiceStartDate).TimeOfDay).Substring(0,5)) - @(Convert.ToString(Convert.ToDateTime(service.ServiceStartDate.AddHours(Convert.ToDouble(service.SubTotal))).TimeOfDay).Substring(0,5))</a>
                        </div>
                    </td>
                    <td class="service-provider">
                        @if (service.ServiceProvider != null)
                        {
                            <img src="~/images/cap.png" alt="">
                            <div class="sp-detail">
                                <span class="fw-bold">@(service.ServiceProvider != null ? (service.ServiceProvider.FirstName + " " + service.ServiceProvider.LastName ) : "")</span>
                                <br>
                                <span class="rating-star">
                                    <img src="~/images/star-ratting-filled.svg" alt="">
                                    <img src="~/images/star-ratting-filled.svg" alt="">
                                    <img src="~/images/star-ratting-filled.svg" alt="">
                                    <img src="~/images/star-ratting-filled.svg" alt="">
                                    <img src="~/images/star-ratting-empty.svg" alt="">
                                    <span class="ratting-number">4</span>
                                </span>

                            </div>
                        }
                    </td>
                    <td class="payment td-center">€<span>@service.TotalCost</span></td>
                    <td class="service-status text-center">
                        <a href="#" class="RateSP-button" onclick="reSchedule(@service.ServiceRequestId)">Reschedule</a>
                        <a href="#" class="cancle-button" onclick="Cancle(@service.ServiceRequestId)">Cancle</a>
                    </td>
                </tr>
            }



        </tbody>
    </table>

    <!-- =====================Custom pegination section============================= -->
    @*<div class="pegination">
            <div class="pegination-rows">
                Show <select id="pegination-select" onchange="rowCount();">
                    <option value="4">4</option>
                    <option value="2">2</option>
                    <option value="6">6</option>
                    <option value="8">8</option>
                    <option value="12">12</option>
                    <option value="15">30</option>
                </select> Entries, Showing Entries from <span id="from-entry"></span> to <span id="to-entry"></span>
            </div>
            <ul class="pegination-pages">
                <li class="prev" id="prev"><a href="#">&#139;</a></li>
                <li class="next" id="next"><a href="#">&#155;</a></li>
            </ul>
        </div>*@

</div>

<!-- jQuery Validation library-->
<script src="~/lib/jquery-validate/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

@section Modals{
    <!-- ------------- Modal--------------- -->
    <div class="Modal " id="Delete-Add-Modal">
        <img class="close-modal" src="~/images/close.png" />
        <h4 class="modal-title mb-3">Delete Address</h4>
        <form asp-controller="User" asp-action="DeleteServiceRequest" onsubmit="return jQueryAjaxPost(this);" method="post">
            <input type="hidden" name="ServiceRequestId" value="" />
            <label for="cancleMessage">Why do you want to cancle the service request ?</label>
            <textarea class="mb-0 valid" name="cancleMessage" data-val="true" data-val-length="The Comment must be a string with a maximum length of 200." maxlength="200" rows="3" id="cancleMessage" data-val-required="The FirstName field is required." data-val-length-max="200" aria-describedby="cancleMessage-error" aria-invalid="false"></textarea>
            <span class="text-danger field-validation-error" data-valmsg-for="cancleMessage" data-valmsg-replace="true" style="font-size: 14px;"></span>
            <button type="submit" class="fw-normal" value="Delete">Cancle Now</button>
        </form>
    </div>

    <div class="Modal Address-Modal mx-2" id="Address-Modal">
        <img class="close-modal" src="~/images/close.png" />
        <h4 class="modal-title my-2" id="Address-Modal-Title"></h4>
        <div id="add-or-edit-address">

        </div>
    </div>

}


@section Scripts
{
    <script>
        function Cancle(ServiceId) {
            console.log("delete modal");
            $("#blur").addClass("blur");
            $("#Delete-Add-Modal").addClass("active");
            $('input[name="ServiceRequestId"]').val(ServiceId);
        }
    </script>
}